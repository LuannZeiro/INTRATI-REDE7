<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="img/logor7.png" type="image/x-icon">
  <title>Relatório Técnico - REDE 7</title>
  <link rel="stylesheet" href="style/style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <style>
       
       * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

form {
  max-width: 600px;
  margin: 0 auto;
  background: #fff;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

label {
  font-weight: bold;
  display: block;
  margin-top: 10px;
}

input, select, textarea, button {
  width: 97%;
  padding: 10px;
  margin-top: 5px;
  margin-bottom: 15px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

button {
  width: 100%;
  background-color: #028108;
  color: white;
  font-size: 16px;
  cursor: pointer;
  border: none;
}

button:hover {
  background-color: #1b4f35;
}

.btn-secondary {
  background-color: #ccc;
  color: #333;
}

.btn-secondary:hover {
  background-color: #bbb;
}

.loading, .error-message, .success-message {
  text-align: center;
  margin-top: 10px;
}

.loading {
  display: none;
}

.error-message {
  color: red;
}

.success-message {
  color: green;
}

.pdf-container {
  position: relative;
  width: 100%;
  max-width: 800px;
  margin: 20px auto;
  border: 2px solid #81c784;
  border-radius: 5px;
  overflow: hidden;
  background: #fff;
}

#pdfCanvas, #signatureCanvas {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: auto;
}

.signature-canvas {
  border: 2px dashed #388e3c;
  border-radius: 5px;
}

.msg {
  margin-top: 15px;
  font-weight: bold;
  text-align: center;
}

.msg.success {
  color: green;
}

.msg.error {
  color: red;
}


@media (max-width: 480px) {
  .botaotermo {
    width: 400px;
    margin-left: -25px;
  }
  h1 {
    font-size: 20px;
  }

  img {
    width: 40px;
    height: 40px;
  }
}


</style>
  
</head>
<body>
  <div class="superior1">
    <div class="logo">
      <h1>RELATÓRIO TÉCNICO</h1>
    </div>
    <div class="logo3">
      <a href="index.html">
        <img src="img/logor7.png" alt="logo" width="70px" height="70px">
      </a>
    </div>
  </div>
  <div class="botaotermo">
    <a href="danilovi.html"><button>Visualizar Relátorios</button></a>
</div>
  <div class="container">
    <form id="relatorioForm">
      <div class="form-group">
        <label for="data_1">Data</label>
        <input type="text" id="data_1" class="input" readonly>
      </div>
      <div class="form-group">
        <label for="nome">Nome do Técnico</label>
        <select id="nome" class="input"required>
          <option value="SELECIONE UM TÉCNICO">SELECIONE UM TÉCNICO</option>
          <option value="DANILO ARAÚJO">DANILO ARAÚJO</option>
          <option value="EVERTON LIMA">EVERTON LIMA</option>
          </select>
      </div>
      <div class="form-group">
        <label for="posto">Posto</label>
        <select id="posto" class="input" required>
          <option value="SELECIONE UM POSTO">SELECIONE UM POSTO</option>
          <option value="84 - PINHEIRO DE BAURU">84 - PINHEIRO DE BAURU</option>
          <option value="141 - CAMINHO DOS PASSAROS">141 - CAMINHO DOS PASSAROS</option>
          <option value="150 - POSTO DE SERVIÇOS JD. DAS ROSAS">150 - POSTO DE SERVIÇOS JD. DAS ROSAS</option>
          <option value="156 - POSTO LUPUS ISABEL BUENO LTDA">156 - POSTO LUPUS ISABEL BUENO LTDA</option>
          <option value="159 - POSTO MARTE LTDA">159 - POSTO MARTE LTDA</option>
          <option value="161 - POSTO PRINCESA DO SUL LTDA">161 - POSTO PRINCESA DO SUL LTDA</option>
          <option value="167 - AUTO POSTO VALE">167 - AUTO POSTO VALE</option>
          <option value="173 - AUTO POSTO ASTER DE ARAÇATUBA">173 - AUTO POSTO ASTER DE ARAÇATUBA</option>
          <option value="180 - VIEGAS AUTO POSTO LTDA">180 - VIEGAS AUTO POSTO LTDA</option>
          <option value="181 - AUTO POSTO PORTAL DA LAPA LTDA">181 - AUTO POSTO PORTAL DA LAPA LTDA</option>
          <option value="202 - AUTO POSTO PRÍNCIPE III LTDA">202 - AUTO POSTO PRÍNCIPE III LTDA</option>
          <option value="211 - AUTO POSTO CALDEIRÃO II LTDA">211 - AUTO POSTO CALDEIRÃO II LTDA</option>
          <option value="212 - AUTO POSTO ROSA BRANCA II LTDA">212 - AUTO POSTO ROSA BRANCA II LTDA</option>
          <option value="220 - AUTO POSTO PESSEGAO II LTDA">220 - AUTO POSTO PESSEGAO II LTDA</option>
          <option value="223 - AUTO POSTO QUINTAS DO MORUMBI II LTDA">223 - AUTO POSTO QUINTAS DO MORUMBI II LTDA</option>
          <option value="230 - AUTO POSTO MOVIMENTO II LTDA">230 - AUTO POSTO MOVIMENTO II LTDA</option>
          <option value="231 - AUTO POSTO ICARO II LTDA">231 - AUTO POSTO ICARO II LTDA</option>
          <option value="243 - AUTO POSTO VILLA ITAICI II LTDA">243 - AUTO POSTO VILLA ITAICI II LTDA</option>
          <option value="246 - AUTO POSTO BARTOLOMEU DE GUSMÃO II LTDA">246 - AUTO POSTO BARTOLOMEU DE GUSMÃO II LTDA</option>
          <option value="252 - VELHO GUERREIRO AUTO POSTO II LTDA">252 - VELHO GUERREIRO AUTO POSTO II LTDA</option>
          <option value="261 - AUTO POSTO AMÉRICA DE BAURU II LTDA">261 - AUTO POSTO AMÉRICA DE BAURU II LTDA</option>
          <option value="270 - AUTO POSTO MARLIM II LTDA">270 - AUTO POSTO MARLIM II LTDA</option>
          <option value="271 - AUTO POSTO RIO CLARENSE II LTDA">271 - AUTO POSTO RIO CLARENSE II LTDA</option>
          <option value="286 - AUTO POSTO NUCLEO II LTDA">286 - AUTO POSTO NUCLEO II LTDA</option>
          <option value="293 - ECOPOSTO II LTDA">293 - ECOPOSTO II LTDA</option>
          <option value="295 - AUTO POSTO LARANJA DA CHINA II LTDA">295 - AUTO POSTO LARANJA DA CHINA II LTDA</option>
          <option value="299 - AUTO POSTO CAPITÃO BRASIL II LTDA">299 - AUTO POSTO CAPITÃO BRASIL II LTDA</option>
          <option value="352 - AUTO POSTO JARDIM PETRÓPOLIS II LTDA">352 - AUTO POSTO JARDIM PETRÓPOLIS II LTDA</option>
          <option value="353 - ASTER JARDIM SILVEIRA POSTO DE SERVICOS II LTDA">353 - ASTER JARDIM SILVEIRA POSTO DE SERVICOS II LTDA</option>
          <option value="362 - POSTO DE SERVIÇOS ASTER RANIERI II LTDA">362 - POSTO DE SERVIÇOS ASTER RANIERI II LTDA</option>
          <option value="364 - AUTO POSTO SAN MARTIN II LTDA">364 - AUTO POSTO SAN MARTIN II LTDA</option>
          <option value="369 - POSTO DE SERVIÇOS V.CARVALHO DE ARAÇATUBA II LTDA">369 - POSTO DE SERVIÇOS V.CARVALHO DE ARAÇATUBA II LTDA</option>
          <option value="371 - POSTO DE SERVIÇOS ASTER VISTA VERDE II LTDA">371 - POSTO DE SERVIÇOS ASTER VISTA VERDE II LTDA</option>
          <option value="401 - AUTO POSTO VISTA DO PANAMBY II LTDA">401 - AUTO POSTO VISTA DO PANAMBY II LTDA</option>
          <option value="402 - AUTO POSTO GRIDE II LTDA">402 - AUTO POSTO GRIDE II LTDA</option>
          <option value="403 - AUTO POSTO TWINGO II LTDA">403 - AUTO POSTO TWINGO II LTDA</option>
          <option value="404 - GOLFINHO 10 SERVICOS AUTOMOTIVOS II LTDA">404 - GOLFINHO 10 SERVICOS AUTOMOTIVOS II LTDA</option>
          <option value="405 - AUTO POSTO BULGARIN LTDA">405 - AUTO POSTO BULGARIN LTDA</option>
          <option value="406 - AUTO POSTO ROCAS LTDA">406 - AUTO POSTO ROCAS LTDA</option>
          <option value="408 - AUTO POSTO ANCONA LTDA">408 - AUTO POSTO ANCONA LTDA</option>
          <option value="409 - AUTO POSTO PÉROLA DO M´BOI MIRIM LTDA">409 - AUTO POSTO PÉROLA DO M´BOI MIRIM LTDA</option>
          <option value="410 - AUTO POSTO PORTAL DA PENHA LTDA - EPP">410 - AUTO POSTO PORTAL DA PENHA LTDA - EPP</option>
          <option value="411 - CENTRO AUTOMOTIVO PENHA LTDA">411 - CENTRO AUTOMOTIVO PENHA LTDA</option>
          <option value="412 - CENTRO AUTOMOTIVO ALDA LTDA">412 - CENTRO AUTOMOTIVO ALDA LTDA</option>
          <option value="414 - AUTO POSTO GUIQUIRINO LTDA">414 - AUTO POSTO GUIQUIRINO LTDA</option>
          <option value="415 - AUTO POSTO ESPELHO DO SOL LTDA">415 - AUTO POSTO ESPELHO DO SOL LTDA</option>
          <option value="416 - AUTO POSTO APECATU LTDA">416 - AUTO POSTO APECATU LTDA</option>
          <option value="417 - AUTO POSTO CENTRAL DE IBIUNA LTDA">417 - AUTO POSTO CENTRAL DE IBIUNA LTDA</option>
          <option value="418 - AUTO POSTO PARQUE ECOLÓGICO II LTDA">418 - AUTO POSTO PARQUE ECOLÓGICO II LTDA</option>
          <option value="419 - AUTO POSTO BRISA DE BAURU II LTDA">419 - AUTO POSTO BRISA DE BAURU II LTDA</option>
          <option value="420 - AUTO POSTO CAPAO REDONDO LTDA">420 - AUTO POSTO CAPAO REDONDO LTDA</option>
          <option value="421 - AUTO POSTO VILAMAR LTDA">421 - AUTO POSTO VILAMAR LTDA</option>
          <option value="422 - AUTO POSTO SOROCABA">422 - AUTO POSTO SOROCABA</option>
          <option value="423 - AUTO POSTO CANOA QUEBRADA - CE LTDA">423 - AUTO POSTO CANOA QUEBRADA - CE LTDA</option>
          <option value="424 - AUTO POSTO JARDIM VALO VELHO LTDA">424 - AUTO POSTO JARDIM VALO VELHO LTDA</option>
          <option value="425 - AUTO POSTO JARDIM PEDREIRA LTDA">425 - AUTO POSTO JARDIM PEDREIRA LTDA</option>
          <option value="426 - CENTRO AUTOMOTIVO AKIRIKO LTDA">426 - CENTRO AUTOMOTIVO AKIRIKO LTDA</option>
          <option value="429 - AUTO POSTO JO-ANA LTDA">429 - AUTO POSTO JO-ANA LTDA</option>
          <option value="430 - POSTO DE SERVIÇOS CITY TAIPAS LTDA">430 - POSTO DE SERVIÇOS CITY TAIPAS LTDA</option>
          <option value="431 - AUTO POSTO PARAIZO DE ALAH LTDA">431 - AUTO POSTO PARAIZO DE ALAH LTDA</option>
          <option value="432 - AUTO POSTO RELUMA LTDA">432 - AUTO POSTO RELUMA LTDA</option>
          <option value="433 - AUTO POSTO MMS LTDA">433 - AUTO POSTO MMS LTDA</option>
          <option value="434 - POSTO DE SERVIÇOS VILA RICA LTDA">434 - POSTO DE SERVIÇOS VILA RICA LTDA</option>
          <option value="435 - GRAMADO POSTO DE SERVIÇOS E COMB. LTDA">435 - GRAMADO POSTO DE SERVIÇOS E COMB. LTDA</option>
          <option value="436 - POSTO DE SERVIÇOS GUADALUPE LTDA">436 - POSTO DE SERVIÇOS GUADALUPE LTDA</option>
          <option value="437 - CITY CANTAREIRA AUTO POSTO EIRELI">437 - CITY CANTAREIRA AUTO POSTO EIRELI</option>
          <option value="438 - AUTO POSTO UNIPO LTDA">438 - AUTO POSTO UNIPO LTDA</option>
          <option value="439 - CRISMAR POSTO DE SERVIÇOS LTDA">439 - CRISMAR POSTO DE SERVIÇOS LTDA</option>
          <option value="440 - AUTO POSTO PROGRESSO">440 - AUTO POSTO PROGRESSO</option>
          <option value="441 - AUTO POSTO EVOLUÇÃO">441 - AUTO POSTO EVOLUÇÃO</option>
          <option value="442 - AUTO POSTO IMPERATRIZ">442 - AUTO POSTO IMPERATRIZ</option>
          <option value="447 - AUTO POSTO EUROPA GARDEN LTDA">447 - AUTO POSTO EUROPA GARDEN LTDA</option>
          <option value="448 - AUTO POSTO NOVA ESTACAO DO PESSEGO LTDA">448 - AUTO POSTO NOVA ESTACAO DO PESSEGO LTDA</option>
          <option value="449 - AUTO POSTO RIO DA PRATA LTDA">449 - AUTO POSTO RIO DA PRATA LTDA</option>
          <option value="450 - COMERCIO VAREJISTA DE COMBUSTIVEIS VELOZ LTDA">450 - COMERCIO VAREJISTA DE COMBUSTIVEIS VELOZ LTDA</option>
          <option value="451 - AUTO POSTO RADIAL III LTDA">451 - AUTO POSTO RADIAL III LTDA</option>
          <option value="452 - AUTO POSTO ESTADAO DE SANTO ANDRE LTDA">452 - AUTO POSTO ESTADAO DE SANTO ANDRE LTDA</option>
          <option value="453 - AUTO POSTO UNIVERSO LTDA">453 - AUTO POSTO UNIVERSO LTDA</option>
          <option value="454 - AUTO POSTO MONTE APRAZIVEL LTDA">454 - AUTO POSTO MONTE APRAZIVEL LTDA</option>
          <option value="455 - AUTO POSTO MATRIZ RUDGE RAMOS LTDA">455 - AUTO POSTO MATRIZ RUDGE RAMOS LTDA</option>
          <option value="456 - SUPER POSTO 3M LTDA">456 - SUPER POSTO 3M LTDA</option>
          <option value="457 - GS POSTO DE COMBUSTIVEL LTDA">457 - GS POSTO DE COMBUSTIVEL LTDA</option>
          <option value="458 - CENTRO AUTOMOTIVO E COMERCIO DE COMBUSTIVEIS MAXXIMA NAZARE LTDA">458 - CENTRO AUTOMOTIVO E COMERCIO DE COMBUSTIVEIS MAXXIMA NAZARE LTDA</option>
          <option value="459 - AUTO POSTO IRMAOS VENTURA LT">459 - AUTO POSTO IRMAOS VENTURA LT</option>
          <option value="460 - AUTO POSTO OURO DE BARUERI LT">460 - AUTO POSTO OURO DE BARUERI LT</option>
          <option value="461 - AUTO POSTO ASTORGA LTDA">461 - AUTO POSTO ASTORGA LTDA</option>
          <option value="462 - AUTO POSTO MADRID LTDA">462 - AUTO POSTO MADRID LTDA</option>
          <option value="463 - FASE QUATTRO ANHANGUERA - COMÉRCIO VAREJISTA DE COMBUSTÍVEIS LTDA">463 - FASE QUATTRO ANHANGUERA - COMÉRCIO VAREJISTA DE COMBUSTÍVEIS LTDA</option>
          <option value="464 - AUTO POSTO TREVO DE ITATIBA LTDA">464 - AUTO POSTO TREVO DE ITATIBA LTDA</option>
          <option value="465 - AUTO POSTO VITRINE II LTDA">465 - AUTO POSTO VITRINE II LTDA</option>
          <option value="466 - CENTRO AUTOMOTIVO DE ABASTECIMENTO BANDEIRA II LTDA">466 - CENTRO AUTOMOTIVO DE ABASTECIMENTO BANDEIRA II LTDA</option>
          <option value="467 - AUTO POSTO VIVA VERÃO II LTDA">467 - AUTO POSTO VIVA VERÃO II LTDA</option>
          <option value="468 - AUTO POSTO NAMORADA II LTDA">468 - AUTO POSTO NAMORADA II LTDA</option>
          <option value="469 - AUTO POSTO ESTACAO ITAQUA LTDA">469 - AUTO POSTO ESTACAO ITAQUA LTDA</option>
          <option value="470 - AUTO POSTO FERRARI LTDA">470 - AUTO POSTO FERRARI LTDA</option>
          <option value="471 - RPA COMERCIO DE COMBUSTIVEIS LIMEIRA I LTDA">471 - RPA COMERCIO DE COMBUSTIVEIS LIMEIRA I LTDA</option>
          <option value="472 - RPA COMERCIO DE COMBUSTIVEIS RIO CLARO II LTDA">472 - RPA COMERCIO DE COMBUSTIVEIS RIO CLARO II LTDA</option>
          <option value="473 - POSTO RIO CLARO CENTER SHOPPING LTDA">473 - POSTO RIO CLARO CENTER SHOPPING LTDA</option>
          <option value="474 - AUTO POSTO PRIMAVERA MURCHID LTDA">474 - AUTO POSTO PRIMAVERA MURCHID LTDA</option>
          <option value="475 - RPA COMERCIO DE COMBUSTIVEIS ITU I LTDA">475 - RPA COMERCIO DE COMBUSTIVEIS ITU I LTDA</option>
          <option value="476 - RPA COMERCIO DE COMBUSTIVEIS PIRACICABA II LTDA">476 - RPA COMERCIO DE COMBUSTIVEIS PIRACICABA II LTDA</option>
          <option value="477 - RPA COMERCIO DE COMBUSTIVEIS PIRACICABA III LTDA">477 - RPA COMERCIO DE COMBUSTIVEIS PIRACICABA III LTDA</option>
          <option value="478 - AUTO POSTO SAO MIGUEL DE PIRACICABA LTDA">478 - AUTO POSTO SAO MIGUEL DE PIRACICABA LTDA</option>
          <option value="479 - AUTO POSTO PORTAL DELFIM VERDE">479 - AUTO POSTO PORTAL DELFIM VERDE</option>
          <option value="480 - POSTO DE REVENDA DE COMBUSTIVEIS NOVO ARNO LTDA">480 - POSTO DE REVENDA DE COMBUSTIVEIS NOVO ARNO LTDA</option>
          <option value="481 - AUTO POSTO ACARI LTDA">481 - AUTO POSTO ACARI LTDA</option>
          <option value="482 - AUTO POSTO VILA ESMERALDA">482 - AUTO POSTO VILA ESMERALDA</option>
          <option value="483 - AUTO POSTO  102 LTDA">483 - AUTO POSTO  102 LTDA</option>
          <option value="484 - AUTO POSTO NOVO BUTANTA">484 - AUTO POSTO NOVO BUTANTA</option>
          <option value="485 - AUTO POSTO DISTRITO DE INDAIA LTDA">485 - AUTO POSTO DISTRITO DE INDAIA LTDA</option>
          <option value="486 - AUTO POSTO LG ELEFANTINHO">486 - AUTO POSTO LG ELEFANTINHO</option>
          <option value="487 - AUTO POSTO MILLENIUM LTDA">487 - AUTO POSTO MILLENIUM LTDA</option>
          <option value="488 - REDE ALSAN RODO APOSTO JALES PISTA">488 - REDE ALSAN RODO APOSTO JALES PISTA</option>
          <option value="490 - POSTO PANTANAL LTDA">490 - POSTO PANTANAL LTDA</option>
          <option value="491 - POSTO DO CRISTO COMERCIO DE COMBUSTIVEIS LTDA">491 - POSTO DO CRISTO COMERCIO DE COMBUSTIVEIS LTDA</option>
          <option value="492 - POSTO REAL COMBUSTIVEIS E DERIVADOS LTDA">492 - POSTO REAL COMBUSTIVEIS E DERIVADOS LTDA</option>
          <option value="493 - POSTO PACAEMBU COMERCIO DE COMBUSTIVEIS LTDA">493 - POSTO PACAEMBU COMERCIO DE COMBUSTIVEIS LTDA</option>
          <option value="494 - REDEPOSTO QUINTANA COMERCIO DE COMBUSTIVEIS LTDA">494 - REDEPOSTO QUINTANA COMERCIO DE COMBUSTIVEIS LTDA</option>
          <option value="495 - POSTO POMPEIA COMERCIO DE COMBUSTIVEIS LTDA">495 - POSTO POMPEIA COMERCIO DE COMBUSTIVEIS LTDA</option>
          <option value="496 - REDEPOSTO BROTAS COMERCIO DE COMBUSTIVEIS LTDA">496 - REDEPOSTO BROTAS COMERCIO DE COMBUSTIVEIS LTDA</option>
          <option value="497 - AUTO POSTO INTERCOOLER">497 - AUTO POSTO INTERCOOLER</option>
          <option value="498 - POSTO DA TORRE LTDA">498 - POSTO DA TORRE LTDA</option>
          <option value="499 - REDE ALSAN QUALITY JALES LTDA">499 - REDE ALSAN QUALITY JALES LTDA</option>
          <option value="501 - POSTO BOA VISTA LTDA - NOVA RUSSIA">501 - POSTO BOA VISTA LTDA - NOVA RUSSIA</option>
          <option value="502 - POSTO BOA VISTA LTDA - GENERAL">502 - POSTO BOA VISTA LTDA - GENERAL</option>
          <option value="503 - POSTO BOA VISTA LTDA - RESERVA">503 - POSTO BOA VISTA LTDA - RESERVA</option>
          <option value="504 - POSTO BOA VISTA LTDA - VISCONDE">504 - POSTO BOA VISTA LTDA - VISCONDE</option>
          <option value="505 - AUTO POSTO GIGANTE DE CONTENDA LTDA">505 - AUTO POSTO GIGANTE DE CONTENDA LTDA</option>
          <option value="506 - POSTO BOA VISTA LTDA - MONTEIRO">506 - POSTO BOA VISTA LTDA - MONTEIRO</option>
          <option value="507 - POSTO BOA VISTA LTDA - IRATI">507 - POSTO BOA VISTA LTDA - IRATI</option>
          <option value="508 - POSTO BOA VISTA LTDA - BALDUINO">508 - POSTO BOA VISTA LTDA - BALDUINO</option>
          <option value="509 - POSTO BOA VISTA LTDA - SIQUEIRA">509 - POSTO BOA VISTA LTDA - SIQUEIRA</option>
          <option value="510 - POSTO BOA VISTA LTDA - GUARAPUAVA">510 - POSTO BOA VISTA LTDA - GUARAPUAVA</option>
          <option value="511 - POSTO BOA VISTA LTDA - CASTRO">511 - POSTO BOA VISTA LTDA - CASTRO</option>
          <option value="513 - AUTO POSTO CAPELA BANDEIRANTES LTDA">513 - AUTO POSTO CAPELA BANDEIRANTES LTDA</option>
          <option value="514 - AUTO POSTO PARQUE CIDADE NOVA">514 - AUTO POSTO PARQUE CIDADE NOVA</option>
          <option value="515 - CENTRO AUTOMOTIVO ATLANTIS LTDA">515 - CENTRO AUTOMOTIVO ATLANTIS LTDA</option>          
        </select>
      </div>      
      <div class="form-group">
        <label for="chamado">Número do Chamado</label>
        <input type="text" id="chamado" class="input" placeholder="Quem solicitou o atendimento">
      </div>
      <div class="form-group">
        <label for="defeito">Defeito</label>
        <input type="text" id="defeito" class="input" placeholder="Descreva o defeito encontrado" required>
      </div>
      <div class="form-group">
        <label for="chegada">Horário de Chegada</label>
        <input type="time" id="chegada" class="input">
      </div>
      <div class="form-group">
        <label for="saida">Horário de Saída</label>
        <input type="time" id="saida" class="input">
      </div>
      <div class="form-group">
        <label for="solucao">Solução</label>
        <textarea id="solucao" class="input" placeholder="Descreva a solução aplicada" required></textarea>
      </div>
      <div class="form-group">
        <label for="equipamento">Equipamentos Utilizados</label>
        <input type="text" id="equipamento" class="input" placeholder="Liste os equipamentos utilizados">
      </div>
      <div class="form-group">
        <label for="empresa">Empresa</label>
        <input type="text" id="empresa" class="input" placeholder="Nome da empresa atendida">
      </div>
      <div class="form-group">
        <label for="responsavel">Responsável pelo Atendimento</label>
        <input type="text" id="responsavel" class="input" placeholder="Nome do responsável">
      </div>
      <button type="button" class="btn" onclick="gerarPDF()">Gerar PDF</button>
    </form>

    <div class="pdf-container">
      <canvas id="pdfCanvas"></canvas>
      <canvas id="signatureCanvas" class="signature-canvas"></canvas>
    </div>

    <button class="btn" onclick="clearSignature()">Limpar Assinatura</button>
    <button class="btn" onclick="enviarDados()">Enviar Relatório</button>

    <div id="mensagem"></div>
  </div>

  <script>
 
    let pdfDoc = null;
    let pdfBlobGlobal = null;


    let signatureCanvas = new fabric.Canvas('signatureCanvas', {
      isDrawingMode: true
    });
    signatureCanvas.freeDrawingBrush.width = 2;
    signatureCanvas.freeDrawingBrush.color = "black";

    // Define a data atual no campo "data_1"
    function definirDataHoraAtual() {
      const agora = new Date();
      const dia = String(agora.getDate()).padStart(2, '0');
      const mes = String(agora.getMonth() + 1).padStart(2, '0');
      const ano = agora.getFullYear();
      document.getElementById("data_1").value = `${dia}/${mes}/${ano}`;
    }

    // Limpa o canvas da assinatura
    function clearSignature() {
      signatureCanvas.clear();
      signatureCanvas.isDrawingMode = true;
    }

    // Gera o PDF chamando o endpoint e renderiza na tela
    async function gerarPDF() {
      let formData = {
        data_1: document.getElementById("data_1").value,
        nome: document.getElementById("nome").value,
        posto: document.getElementById("posto").value,
        chamado: document.getElementById("chamado").value,
        defeito: document.getElementById("defeito").value,
        chegada: document.getElementById("chegada").value,
        saida: document.getElementById("saida").value,
        solucao: document.getElementById("solucao").value,
        equipamento: document.getElementById("equipamento").value,
        empresa: document.getElementById("empresa").value,
        responsavel: document.getElementById("responsavel").value
      };

      let response = await fetch("http://172.20.20.127:3000/generate/rvt", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData)
      });

      if (!response.ok) {
        alert("Erro ao gerar PDF!");
        return;
      }

      let pdfBlob = await response.blob();
      pdfBlobGlobal = pdfBlob; // Armazena para uso posterior
      loadPDF(pdfBlob);
    }

    // Renderiza o PDF usando pdf.js para visualização
async function loadPDF(pdfBlob) {
  const arrayBuffer = await pdfBlob.arrayBuffer();
  pdfDoc = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
  let page = await pdfDoc.getPage(1);
  
  // Ajusta a escala para ocupar a largura total do container
  let container = document.querySelector('.pdf-container');
  let scale = container.clientWidth / page.getViewport({ scale: 1 }).width; 

  let viewport = page.getViewport({ scale });

  let canvas = document.getElementById('pdfCanvas');
  canvas.width = viewport.width;
  canvas.height = viewport.height;
  
  signatureCanvas.setWidth(viewport.width);
  signatureCanvas.setHeight(viewport.height);

  let renderContext = {
    canvasContext: canvas.getContext('2d'),
    viewport: viewport
  };
  await page.render(renderContext);
}


    // Usa PDF-lib para incorporar a assinatura no PDF
    async function adicionarAssinaturaAoPDF(pdfBlob) {
      // Carrega o PDF com PDF-lib
      const arrayBuffer = await pdfBlob.arrayBuffer();
      const pdfLibDoc = await PDFLib.PDFDocument.load(arrayBuffer);
      const pages = pdfLibDoc.getPages();
      const primeiraPagina = pages[0];

      // Captura a imagem da assinatura como Data URL (PNG)
      const signatureDataUrl = signatureCanvas.toDataURL('image/png');
      // Converte a Data URL para ArrayBuffer
      const signatureImageBytes = await fetch(signatureDataUrl).then(res => res.arrayBuffer());
      // Incorpora a imagem no PDF
      const pngImage = await pdfLibDoc.embedPng(signatureImageBytes);
      // Define escala e dimensões para a assinatura
      const pngDims = pngImage.scale(0.8);
      const pageWidth = primeiraPagina.getWidth();
      const pageHeight = primeiraPagina.getHeight();
      const margin = 100; // margem para posicionamento
      
      const x = -20;
      const y = -20;
      primeiraPagina.drawImage(pngImage, { x, y, width: pngDims.width, height: pngDims.height });
      
      // Salva o PDF modificado e retorna os bytes
      const modifiedPdfBytes = await pdfLibDoc.save();
      return modifiedPdfBytes;
    }

    // Converte um Blob em uma string base64
    function blobToBase64(blob) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onloadend = function() {
          // reader.result vem no formato dataURL; remove o prefixo
          const dataUrl = reader.result;
          const base64 = dataUrl.split(',')[1];
          resolve(base64);
        };
        reader.onerror = reject;
        reader.readAsDataURL(blob);
      });
    }

    // Envia os dados e o PDF modificado (com a assinatura incorporada) via JSON raw
    async function enviarDados() {
      const mensagem = document.getElementById("mensagem");
      mensagem.textContent = "Enviando relatório...";

      if (!pdfBlobGlobal) {
        mensagem.textContent = "Nenhum PDF gerado.";
        return;
      }

      try {
        // Incorpora a assinatura no PDF
        const modifiedPdfBytes = await adicionarAssinaturaAoPDF(pdfBlobGlobal);
        const modifiedPdfBlob = new Blob([modifiedPdfBytes], { type: "application/pdf" });
        
        // Converte o Blob do PDF para base64
        const base64pdf = await blobToBase64(modifiedPdfBlob);

        // Cria o objeto JSON com os dados do formulário e o PDF em base64
        const data = {
          data_1: document.getElementById("data_1").value,
          nome: document.getElementById("nome").value,
          posto: document.getElementById("posto").value,
          chamado: document.getElementById("chamado").value,
          defeito: document.getElementById("defeito").value,
          chegada: document.getElementById("chegada").value,
          saida: document.getElementById("saida").value,
          solucao: document.getElementById("solucao").value,
          equipamento: document.getElementById("equipamento").value,
          empresa: document.getElementById("empresa").value,
          responsavel: document.getElementById("responsavel").value,
          pdf: base64pdf
        };

        // Envia os dados como JSON raw para o servidor
        const response = await fetch("http://172.20.20.127:3000/rvt", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        if (!response.ok) {
          mensagem.textContent = "Erro ao enviar, preencha os campos!";
          return;
        }

        mensagem.textContent = "Relatório enviado com sucesso, men!";
      } catch (err) {
        console.error(err);
        mensagem.textContent = "Erro ao modificar o PDF.";
      }
    }

    window.onload = definirDataHoraAtual;
  </script>
</body>
</html>
